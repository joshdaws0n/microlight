<div class="sticky-sidebar px-0 pt-0" id="sidebar">
  <div class="sidebar-main d-flex align-items-center justify-content-between px-3">
    <!-- Left side: Blog name -->
    <div class="blog-name">
      <a class="no-under" href="/">
        <!-- Profile photo -->
        <a class="d-flex align-items-center" href="/">
          <img src="{{ .Site.Author.avatar }}" alt="Profile Photo" class="rounded me-2" style="width: 32px; height: 32px; object-fit: cover;" />
        </a>
        {{ .Site.Title }}
      </a>
    </div>

    <!-- Right side: Search, Profile, LastFM, Menu -->
    <div class="d-flex align-items-center gap-2">
      <!-- Search container -->
      <div class="position-relative">
        <!-- Search button -->
        <button id="search-toggle" class="btn border-0 p-2" aria-label="Search">
          <i class="fas fa-search"></i>
        </button>
        
        <!-- Search form (positioned relative to button) -->
        <form id="search-form" class="search-form collapsed border border-2" role="search">
          <input type="text" name="q" id="search-input" class="form-control" placeholder="Search...">
        </form>
      </div>
    
      <!-- Last.fm -->
      {{ with .Site.Params.lastfmUsername }}
        {{ if ne . "" }}
        <a class="no-under d-flex align-items-center" href="https://last.fm/user/{{ . }}" target="_blank">
          <div class="album-wrapper position-relative">
            <div class="spinner-overlay" id="spinner-overlay-side">
              <div class="spinner"></div>
            </div>
            <div class="lastfm-overlay d-none rounded" id="lastfm-overlay">
              <i class="fab fa-lastfm"></i>
            </div>
            <img src="{{ "img/note.png" | relURL }}" alt="Album Art" class="rounded" style="width: 32px; height: 32px; object-fit: cover;" id="last-fm-art-side">
          </div>
        </a>
        {{ end }}
      {{ end }}

      <!-- Menu dropdown -->
      <div class="btn-group dropdown position-relative">
        <button type="button" class="btn border-0 p-2" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fa-solid fa-bars"></i>
        </button>
        
        <!-- Desktop dropdown panel -->
        <div class="sidebar-overlay-panel border-end d-none d-md-block" id="sidebar-overlay-panel-desktop">
          <div class="p-4">
            <!-- Dropdown menu links -->
            <div class="d-grid gap-2">
              {{ $url := .RelPermalink }}
              {{ range .Site.Menus.main }}
                {{ if .Page.Params.redirect }}
                <a class="btn btn-secondary rounded  btn-sm {{ if eq .URL $url }}active{{ end }}" href="{{ .Page.Params.redirect }}">{{ .Name }}</a>
                {{ else }}
                <a class="btn btn-secondary rounded  btn-sm {{ if eq .URL $url }}active{{ end }}" href="{{ .URL | relLangURL | safeURL }}">{{ .Name }}</a>
                {{ end }}
              {{ end }}
              <p class="text-center mb-0">Categories</p>
              {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
                <a class="btn btn-secondary rounded btn-sm category-btn" href="{{ "/categories/" | relURL }}{{ $name | urlize }}">
                  {{ $name | title }}
                  <span class="badge text-bg-light ms-1">
                    {{ len $taxonomy }}
                  </span>
                </a>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Mobile slide-in panel -->
  <div class="sidebar-overlay-panel border-end d-md-none" id="sidebar-overlay-panel-mobile">
    <div class="p-4">
      <!-- Dropdown menu links -->
      <div class="d-grid gap-2">
        {{ $url := .RelPermalink }}
        {{ range .Site.Menus.main }}
          {{ if .Page.Params.redirect }}
          <a class="btn btn-secondary rounded  btn-sm {{ if eq .URL $url }}active{{ end }}" href="{{ .Page.Params.redirect }}">{{ .Name }}</a>
          {{ else }}
          <a class="btn btn-secondary rounded  btn-sm {{ if eq .URL $url }}active{{ end }}" href="{{ .URL | relLangURL | safeURL }}">{{ .Name }}</a>
          {{ end }}
        {{ end }}
        <p class="text-center mb-0">Categories</p>
        {{ range $name, $taxonomy := .Site.Taxonomies.categories }}
          <a class="btn btn-secondary rounded btn-sm category-btn" href="{{ "/categories/" | relURL }}{{ $name | urlize }}">
            {{ $name | title }}
            <span class="badge text-bg-light ms-1">
              {{ len $taxonomy }}
            </span>
          </a>
        {{ end }}
      </div>
    </div>
  </div>
</div>

